<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculateur de coût carbone des mobilités pendulaires</title>
  <style>
    /* Styles CSS */
    body {
      background-color: #F5F5F5;
      color: #333333;
      font-family: 'Roboto', Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      box-sizing: border-box;
    }

    #calculator {
      background-color: #FFFFFF;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      max-width: 400px;
      width: 100%;
    }

    #graph-container {
      flex: 1;
      margin-left: 40px;
      max-width: 800px;
      width: 100%;
    }

    h2 {
      color: #007BFF;
      font-size: 24px;
      margin-bottom: 20px;
    }

    label {
      font-size: 16px;
      margin-top: 15px;
      display: block;
    }

    input[type="range"], select, input[type="number"] {
      border: 1px solid #DDDDDD;
      border-radius: 4px;
      padding: 8px;
      width: 100%;
      max-width: 300px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }

    input[type="range"]:hover, select:hover, input[type="number"]:hover {
      border-color: #007BFF;
      box-shadow: 0 4px 8px rgba(0, 123, 255, 0.2);
    }

    output {
      font-size: 18px;
      font-weight: bold;
      color: #007BFF;
    }

    #results {
      margin-top: 20px;
    }

    @media (max-width: 1000px) {
      body {
        flex-direction: column;
      }

      #graph-container {
        margin-left: 0;
        margin-top: 40px;
      }
    }

    @media (max-width: 600px) {
      h2 {
        font-size: 20px;
      }

      label {
        font-size: 14px;
      }

      input[type="range"], select, input[type="number"] {
        width: 100%;
      }
    }
  </style>
  <!-- Intégration de Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div id="calculator">
    <h2>Calculateur du coût social du carbone émis par les mobilités pendulaires</h2>

    <label for="distance">Distance parcourue aller-retour (km) :</label>
    <input type="range" id="distance" min="1" max="100" value="20">
    <output id="distanceValue">20 km</output>

    <label for="departement">Région :</label>
    <select id="departement">
      <option value="120.7">Île-de-France</option>
      <option value="121.8">Hauts-de-France</option>
      <option value="123.9">Grand Est</option>
      <option value="123.9">Bourgogne-Franche-Comté</option>
      <option value="124">Centre-Val de Loire</option>
      <option value="122.8">Pays de la Loire</option>
      <option value="122.3">Normandie</option>
      <option value="123.6">Nouvelle-Aquitaine</option>
      <option value="122.2">Occitanie</option>
      <option value="122.9">Bretagne</option>
      <option value="123">Auvergne-Rhône-Alpes</option>
      <option value="121.4">Provence-Alpes-Côte d'Azur</option>
      <option value="124.7">Corse</option>
    </select>

    <label for="habitants">Nombre d'habitants :</label>
    <input type="number" id="habitants" min="1" value="1000">

    <div id="results">
      <h2>Résultats :</h2>
      <p>Émissions de CO2 : <output id="emissions">0 kg CO2</output></p>
      <p>Coût social sur une année : <output id="cout">0 €</output></p>
      <p>Coût social sur 10 ans (stable) : <output id="cout10ans" title="Coût social calculé sur la base du prix de 172€ la tonne de Co2 selon les chiffres INSEE sur l'année 2023" >0 €</output></p>
      <p>Coût social sur 50 ans (stable) : <output id="cout50ans">0 €</output></p>
      <p>Coût social sur 50 ans (augmentation) : <output id="cout50ansAugmentation">0 €</output></p>
      <p>Coût social sur 50 ans (augmentation + électrification) : <output id="cout50ansElectrification">0 €</output></p>
    </div>
  </div>

  <!-- Zone pour le graphique -->
  <div id="graph-container">
    <canvas id="myChart"></canvas>
  </div>

  <script>
    // JavaScript
    const distanceSlider = document.getElementById('distance');
    const distanceValue = document.getElementById('distanceValue');
    const departementSelect = document.getElementById('departement');
    const habitantsInput = document.getElementById('habitants');
    const emissionsOutput = document.getElementById('emissions');
    const coutOutput = document.getElementById('cout');
    const cout10ansOutput = document.getElementById('cout10ans');
    const cout50ansOutput = document.getElementById('cout50ans');
    const cout50ansAugmentationOutput = document.getElementById('cout50ansAugmentation');
    const cout50ansElectrificationOutput = document.getElementById('cout50ansElectrification');

    // Configuration du graphique
    const ctx = document.getElementById('myChart').getContext('2d');
    let myChart;

    function updateCalcul() {
      const distance = parseFloat(distanceSlider.value);
      const consommation = parseFloat(departementSelect.value);
      const habitants = parseFloat(habitantsInput.value);
      const trajetsParAn = 220; // Nombre de jours travaillés par an

      // Calcul des émissions (en kg CO2)
      const emissions = distance * consommation * trajetsParAn * habitants / 1000;
      emissionsOutput.textContent = `${emissions.toLocaleString('fr-FR')} kg CO2`;

      // Calcul du coût social annuel (en euros)
      const coutAnnuel = emissions * 172 / 1000; // Conversion en tonnes
      coutOutput.textContent = `${coutAnnuel.toLocaleString('fr-FR')} €`;

      // Calcul du coût social sur 10 ans (coût stable)
      const cout10ans = coutAnnuel * 10;
      cout10ansOutput.textContent = `${cout10ans.toLocaleString('fr-FR')} €`;

      // Calcul du coût social sur 50 ans (coût stable)
      const cout50ans = coutAnnuel * 50;
      cout50ansOutput.textContent = `${cout50ans.toLocaleString('fr-FR')} €`;

      // Calcul du coût social sur 50 ans (coût augmentant de 4 €/tonne/an)
      let coutCumuleAugmentation = 0;
      for (let annee = 1; annee <= 50; annee++) {
        const coutAnnuelAugmentation = emissions * (172 + 4 * (annee - 1)) / 1000;
        coutCumuleAugmentation += coutAnnuelAugmentation;
      }
      cout50ansAugmentationOutput.textContent = `${coutCumuleAugmentation.toLocaleString('fr-FR')} €`;

      // Calcul du coût social sur 50 ans (augmentation + électrification)
      let coutCumuleElectrification = 0;
      let parcElectrifie = 4.8; // Pourcentage initial du parc électrifié
      for (let annee = 1; annee <= 50; annee++) {
        // Calcul des émissions réduites grâce à l'électrification
        const emissionsReduites = (-0.8575 * parcElectrifie + 125.57) * distance * trajetsParAn * habitants / 1000;
        // Coût social avec augmentation annuelle de 4 €/tonne
        const coutAnnuelElectrification = emissionsReduites * (172 + 4 * (annee - 1)) / 1000;
        coutCumuleElectrification += coutAnnuelElectrification;
        // Augmentation du parc électrifié de 1,9 % par an
        parcElectrifie += 1.9;
      }
      cout50ansElectrificationOutput.textContent = `${coutCumuleElectrification.toLocaleString('fr-FR')} €`;

      // Mise à jour du graphique
      updateChart(coutAnnuel, emissions);
    }

    function updateChart(coutAnnuel, emissions) {
      const annees = Array.from({ length: 50 }, (_, i) => i + 1); // 50 années
      const coutStable = annees.map((annee) => coutAnnuel * annee); // Coût cumulé stable
      const coutAugmentation = annees.map((annee) => {
        let total = 0;
        for (let i = 1; i <= annee; i++) {
          total += emissions * (172 + 4 * (i - 1)) / 1000;
        }
        return total;
      });
      const coutElectrification = annees.map((annee) => {
        let total = 0;
        let parcElectrifie = 4.8; // Pourcentage initial du parc électrifié
        for (let i = 1; i <= annee; i++) {
          const emissionsReduites = (-0.8575 * parcElectrifie + 125.57) * distanceSlider.value * 220 * habitantsInput.value / 1000;
          total += emissionsReduites * (172 + 4 * (i - 1)) / 1000;
          parcElectrifie += 1.9; // Augmentation annuelle de 1,9 %
        }
        return total;
      });

      if (myChart) {
        myChart.destroy(); // Détruire le graphique existant
      }

      myChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: annees,
          datasets: [
            {
              label: 'Coût cumulé (coût stable)',
              data: coutStable,
              borderColor: '#007BFF',
              fill: false,
            },
            {
              label: 'Coût cumulé (coût augmentant de 4 €/tonne/an)',
              data: coutAugmentation,
              borderColor: '#FF6384',
              fill: false,
            },
            {
              label: 'Coût cumulé (augmentation + électrification)',
              data: coutElectrification,
              borderColor: '#32CD32',
              fill: false,
            },
          ],
        },
        options: {
          scales: {
            x: {
              title: {
                display: true,
                text: 'Années',
              },
            },
            y: {
              title: {
                display: true,
                text: 'Coût social cumulé (€)',
              },
            },
          },
        },
      });
    }

    distanceSlider.addEventListener('input', () => {
      distanceValue.textContent = `${distanceSlider.value} km`;
      updateCalcul();
    });

    departementSelect.addEventListener('change', updateCalcul);
    habitantsInput.addEventListener('input', updateCalcul);

    // Initialisation
    updateCalcul();
  </script>
</body>
</html>
